<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="language" content="en" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="google" content="notranslate" />
        <meta http-equiv="Content-Language" content="en" />
        <title>ioLB Playoff Card Generator</title>

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <style>
            .grid-item {
                background-color: #ffffff;
                color: #000;

                min-height: 120px;
                border: 2px solid #000000;
                font-weight: normal;
                border-radius: 5px;

                display: flex;
                align-items: center;
                justify-content: center;
                cursor: grab;
                user-select: none;
            }
            .grid-item.dragging {
                background-color: #ffbebe; /* Light blue */
                border: 2px dashed #ff0000; /* Blue dashed border */
                opacity: 0.8;
            }

            .grid-item.drag-hover {
                background-color: #c3ffc7; /* Gold */
                border: 2px dashed #007c25; /* Blue dashed border */
            }

            .dragging {
                background-color: #b8b7ff; /* Light blue */
                border: 2px dashed #120084; /* Blue dashed border */
                opacity: 0.8;
            }
            .responsive-font {
                font-size: 0.75rem; /* Default for small screens */
            }

            @media (min-width: 768px) {
                .responsive-font {
                    font-size: 0.9rem; /* Medium screens */
                }
            }

            @media (min-width: 992px) {
                .responsive-font {
                    font-size: 1.2rem; /* Large screens */
                }
            }
        </style>
    </head>
    <body>
        <div class="container my-5 p-5">
            <div id="grid-container container p-5" class="">
                <h1 class="text-center">⚾ioLB Round 1 Playoff Card⚾</h1>
                <div style="color: #fff" class="text-center">
                    <small
                        >What will happen in the first 4 games of the playoffs?
                        (Drag & drop to rearrange the grid)</small
                    >
                </div>
                <div class="row w-auto px-4">
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                </div>

                <div class="row w-auto px-4">
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                </div>

                <div class="row w-auto px-4">
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                </div>

                <div class="row w-auto pb-4 px-4">
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                    <div
                        class="col-3 responsive-font grid-item d-flex align-items-center justify-content-center"
                        draggable="true"
                    >⚾</div>
                </div>
            </div>
            <button id="save-btn" class="btn btn-primary float-end">
                Save Image
            </button>
            <small class=""
                >Select your bets. Earn points for each correct bet & also every
                full row/column/diagonal. Assume all bets are "At the end of the
                game..."</small
            >
            <div id="checkboxes" class="checkbox-container fs-4"></div>
            <div class="py-5 text-center small"><small>ioBaseball</small></div>
        </div>

        <!-- Bootstrap JS and Popper.js -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const saveButton = document.getElementById("save-btn");
                const checkboxContainer = document.getElementById("checkboxes");
                const gridItems = document.querySelectorAll(".grid-item");
                const gridContainer = document.getElementById("grid-container");
                const checkboxList = [
                    "VA defeats SF",
                    "SF defeats VA",
                    "HFD defeats DEN",
                    "DEN defeats HFD",
                    "WY defeats CLB",
                    "CLB defeats WY",
                    "ORL defeats WA",
                    "WA defeats ORL",

                    "A team's final score 14+ runs",
                    "A team's final score 12 or 13 runs",
                    "A team's final score 10 or 11 runs",
                    "A team's final score 8 or 9 runs",
                    "A team's final score 7 runs",
                    "A team's final score 6 runs",
                    "A team's final score 1 run",
                    "A team's final score 0 runs",

                    "19 or more hits from a team",
                    "17 or 18 hits from a team",
                    "15 or 16 hits from a team",
                    "13 or 14 hits from a team",
                    "11 or 12 hits from a team",
                    "5 hits from a team",
                    "4 hits from a team",
                    "3 or fewer hits from a team",

                    "A pitcher throws 18+ SOs",
                    "A pitcher throws 16 or 17 SOs",
                    "A pitcher throws 14 or 15 SOs",
                    "A pitcher throws 13 SOs",
                    "A pitcher throws 12 SOs",
                    "A pitcher throws 6 SOs",
                    "A pitcher throws 5 SOs",
                    "A pitcher throws 4 or less SOs",

                    "🍿FREE SPACE! +1 pt🍿",
                ];

                function addToGrid(itemText) {
                    const gridItems = document.querySelectorAll(".grid-item");
                    console.log(gridItems);
                    const emptyCells = Array.from(gridItems).filter(
                        (item) =>
                            !item.textContent.trim() || item.textContent == "⚾"
                    );

                    if (emptyCells.length > 0) {
                        const randomCell =
                            emptyCells[
                                Math.floor(Math.random() * emptyCells.length)
                            ];
                        randomCell.textContent = itemText;
                    } else {
                        // If no empty cells, trigger the checkbox to be unchecked and show an alert
                        const checkbox = document.querySelector(
                            `input[value="${itemText}"]`
                        );
                        if (checkbox) {
                            checkbox.checked = false;
                            showAlert(
                                "No more empty cells! Uncheck another box first",
                                "danger"
                            ); // Show alert
                        }
                    }
                }

                // Function to remove the unchecked item from grid and replace it with "empty"
                function removeFromGrid(checkboxValue) {
                    gridItems.forEach((item) => {
                        if (item.textContent == checkboxValue) {
                            item.textContent = "⚾"; // Replace the content of the unchecked cell with "empty"
                        }
                    });
                }

                function showAlert(message, type = "danger") {
                    const container = document.querySelector(".container");
                    const alert = document.createElement("div");
                    alert.classList.add("alert", `alert-${type}`, "mt-3");
                    alert.textContent = message;

                    container.insertBefore(alert, container.firstChild);

                    // Automatically dismiss after 3 seconds
                    setTimeout(() => {
                        alert.remove();
                    }, 3000);
                }

                // Function to handle dragging and dropping
                //let draggedItem = null;
                // gridItems.forEach(item => {
                //     item.addEventListener('dragstart', (e) => {
                //         draggedItem = e.target;
                //         setTimeout(() => {
                //             e.target.classList.add('dragging');
                //         }, 0);
                //     });

                //     item.addEventListener('dragend', (e) => {
                //         e.target.classList.remove('dragging');
                //     });

                //     item.addEventListener('dragover', (e) => {
                //         e.preventDefault();
                //     });

                //     item.addEventListener('dragenter', (e) => {
                //         e.preventDefault();
                //         if (e.target !== draggedItem) {
                //             e.target.classList.add('drag-hover');
                //         }
                //     });

                //     item.addEventListener('dragleave', (e) => {
                //         e.target.classList.remove('drag-hover');
                //     });

                //     item.addEventListener('drop', (e) => {
                //         e.preventDefault();
                //         if (e.target !== draggedItem) {
                //             e.target.classList.remove('drag-hover');
                //             const targetItem = e.target;
                //             const tempText = draggedItem.textContent;
                //             draggedItem.textContent = targetItem.textContent;
                //             targetItem.textContent = tempText;
                //         }
                //     });
                // });
                // mobile drag and drop
                //let draggedItem = null;
                let draggedItem = null;
                let touchStartX = 0;
                let touchStartY = 0;
                let previousHoverItem = null;

                gridItems.forEach((item) => {
                    // Desktop drag events
                    item.addEventListener("dragstart", (e) => {
                        draggedItem = e.target;
                        setTimeout(() => {
                            e.target.classList.add("dragging");
                        }, 0);
                    });

                    item.addEventListener("dragend", (e) => {
                        e.target.classList.remove("dragging");
                        draggedItem = null;
                    });

                    item.addEventListener("dragover", (e) => {
                        e.preventDefault();
                    });

                    item.addEventListener("dragenter", (e) => {
                        e.preventDefault();
                        if (e.target !== draggedItem) {
                            e.target.classList.add("drag-hover");
                        }
                    });

                    item.addEventListener("dragleave", (e) => {
                        e.target.classList.remove("drag-hover");
                    });

                    item.addEventListener("drop", (e) => {
                        e.preventDefault();
                        if (e.target !== draggedItem) {
                            e.target.classList.remove("drag-hover");
                            const targetItem = e.target;
                            const tempText = draggedItem.textContent;
                            draggedItem.textContent = targetItem.textContent;
                            targetItem.textContent = tempText;
                        }
                    });

                    // Mobile touch events
                    item.addEventListener("touchstart", (e) => {
                        e.preventDefault();
                        draggedItem = e.target;
                        touchStartX = e.touches[0].clientX;
                        touchStartY = e.touches[0].clientY;
                        draggedItem.classList.add("dragging");
                    });

                    item.addEventListener("touchmove", (e) => {
                        e.preventDefault();
                        const touch = e.touches[0];
                        const elementBelow = document.elementFromPoint(
                            touch.clientX,
                            touch.clientY
                        );

                        if (
                            elementBelow &&
                            elementBelow.classList.contains("grid-item") &&
                            elementBelow !== draggedItem
                        ) {
                            if (
                                previousHoverItem &&
                                previousHoverItem !== elementBelow
                            ) {
                                previousHoverItem.classList.remove(
                                    "drag-hover"
                                );
                            }

                            elementBelow.classList.add("drag-hover");
                            previousHoverItem = elementBelow;
                        }
                    });

                    item.addEventListener("touchend", (e) => {
                        e.preventDefault();
                        const touchEndX = e.changedTouches[0].clientX;
                        const touchEndY = e.changedTouches[0].clientY;

                        const elementBelow = document.elementFromPoint(
                            touchEndX,
                            touchEndY
                        );
                        if (
                            elementBelow &&
                            elementBelow.classList.contains("grid-item") &&
                            elementBelow !== draggedItem
                        ) {
                            elementBelow.classList.remove("drag-hover");
                            const tempText = draggedItem.textContent;
                            draggedItem.textContent = elementBelow.textContent;
                            elementBelow.textContent = tempText;
                        }

                        if (previousHoverItem) {
                            previousHoverItem.classList.remove("drag-hover");
                        }

                        draggedItem.classList.remove("dragging");
                        draggedItem = null;
                        previousHoverItem = null;
                    });
                });

                // Create and append checkboxes to the container
                checkboxList.forEach((item, index) => {
                    const div = document.createElement("div");
                    div.classList.add(
                        "form-check",
                        "form-check-inline",
                        "mb-2"
                    );

                    const input = document.createElement("input");
                    input.type = "checkbox";
                    input.classList.add("form-check-input");
                    input.id = `checkbox${index + 5}`;
                    input.value = item;

                    const label = document.createElement("label");
                    label.classList.add("form-check-label");
                    label.setAttribute("for", input.id);
                    label.textContent = item;

                    div.appendChild(input);
                    div.appendChild(label);

                    checkboxContainer.appendChild(div);

                    // Add event listener to each checkbox
                    input.addEventListener("change", () => {
                        if (input.checked) {
                            addToGrid(input.value);
                        } else {
                            removeFromGrid(input.value);
                        }
                    });
                });

                // Load html2canvas script dynamically
const script = document.createElement("script");
script.src = "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
document.head.appendChild(script);

script.onload = () => {
    saveButton.addEventListener("click", () => {
        html2canvas(gridContainer, {
            scale: window.devicePixelRatio, // High resolution
            useCORS: true, // Fix cross-origin issues
        })
            .then((canvas) => {
                // Generate the image
                const imageURL = canvas.toDataURL("image/png");
                const now = new Date();
                const dateString = `${now.getFullYear()}-${String(
                    now.getMonth() + 1
                ).padStart(2, "0")}-${String(now.getDate()).padStart(2, "0")}`;

                // Mobile-friendly download handling
                const link = document.createElement("a");
                link.href = imageURL;
                link.download = `bingo-grid-${dateString}.png`;

                // iOS workaround: Open in a new tab
                if (navigator.userAgent.includes("iPhone") || navigator.userAgent.includes("iPad")) {
                    const newWindow = window.open(imageURL, "_blank");
                    if (!newWindow) {
                        alert(
                            "Unable to open the image. Please allow popups in your browser settings."
                        );
                    }
                } else {
                    link.click();
                }
            })
            .catch((error) => {
                console.error("Error generating canvas:", error);
                alert("Failed to save the image. Please try again.");
            });
    });
};

            });
        </script>
    </body>
</html>
